# NOTE: If you are viewing this README.md file in an IDE, you can view the rendered markdown version of this file at [\[github link\]](https://github.com/Mozzle/ASGC_Farming_System/tree/main/NUCLEO-H755ZI/ASGC_Farming_System) or by pressing `CTRL+SHIFT+V` if you are using VS Code.


# 1) IF YOU TAKE ONE THING AWAY FROM THIS README FILE, TAKE THIS:

**ONLY ADD CODE IN USER CODE AREAS:**

```
/* USER CODE BEGIN 0 */

 [ ADD YOUR CODE HERE ]

/* USER CODE END 0 */

```

**IF YOU ADD YOUR CODE IN NON-USER CODE AREAS, IT WILL GET DELETED THE NEXT TIME CODE IS GENERATED:**

```
/* USER CODE BEGIN 0 */

 ...

/* USER CODE END 0 */

[ CODE THAT WILL BE DELETED ]
```



# 2) This subdirectory is home to the source code and project files for the STM32 NUCLEO-H755ZI-Q board that serves as the brains of the farming system.

**This readme file details the components of this subdirectory and the structure of the software project:**

```
.settings/
.vscode/
CM4/
CM7/
Common/
Drivers/
Middlewares/
.mxproject
.project
ASGC_Farming_System.ioc
README.md
```

### First, the  `.project` file:

This is the STM32CubeIDE launcher file for this project. Double clicking on this file from a file explorer will launch the development enviornments. Enviornment settings are stored in the .project and .mxproject files, making this file behave very similar to the .code-workspace file for VS Code projects.

### Next, the `ASGC_Farming_System.ioc` file:

ASGC_Farming_System.ioc is the project launcher file for STM32CubeMX. Opening this file allows the user to modify the processor and middleware setup. In STM32CubeMX, you can modify everything from pin assignments to connectivity libraries and built-in driver functionalities. When you 'Generate Code' in STM32CubeMX, this creates all of the non-user generated code on the project.

## Next, let's look at all of the subdirectories in this project:


### `CM4/` 
This is the source code for the Arm Cortex M4 processor core in the microcontroller. We do not currently use this core in this project, so you will not need to modify any code in this subdirectory.

### `CM7/`
This is the source code for the Arm Cortex M7 processor core in the microcontroller. This is the core that we do develop for in this project, and **virtually all code changes you make will be in this subdirectory.**

### `Common/`
This folder contains autogenerated code that is common between the two microcontroller cores.

### `Drivers/` 
This folder contains low-level autogenerated drivers that make up the Hardware Abstraction Library (HAL). The HAL is provided by STM32CubeMX to make baremetal programming on STM32 chips relatively straightforward.

### `Middlewares/` 
This folder contains medium-level autogenerated drivers. Currently, there is only the STM32-provided USB library inside.


## Let's look inside the `CM7/` folder at the structure of the code we care most about:

```
Core/
Debug/
USB_HOST/
```

### `Core/` 
Inside of here is the majority of the source code for the project.

### `Debug/`
This folder contains debugging build artifacts. This is not actual source code.

### `USB_HOST/` 
This folder contains project-side utilizations of the USB library. Most of this code is autogenerated, but project-side changes have to be made to properly utilize USB functionality.

## Now, inside of the `Core/` folder:

```
Inc/
Src/
Startup/
```

### `Inc/`
This folder contains all C header files for the Cortex M7 Core.

### `Src/`
This folder contains all C source files for the core.

### `Startup/`
This folder contains the Assembly setup file for the core. This file is fully autogenerated, and does the lowest-level setup for the chip and links to the main() C entry point of the program. DO NOT edit this file, you can permanently brick your microcontroller by making changes here without knowing what you're doing.

## Now, inside of `Src/`:

```
AHT20.c
buttons.c
CNC.c
fan_pwm_intf.c
FS_math.c
gpio_switching_intf.c
main.c
mixing_motor.c
SEN0169.c
SEN0244.c
stm32h7xx_hal_msp.c
stm32h7xx_it.c
syscalls.c
sysmem.c
timer.c
```

**AHT20.c**: Project-side driver for the AHT20 temperature and humidity sensor

**buttons.c**: Code covering 'Start' and 'E-Stop' button interrupts and functionality

**CNC.c**: Handles the generation and sending of G-code commands to the SKR Mini E3 V3.0 CNC Control board via USB CDC, as well as higher level CNC functions.

**fan_pwm_intf.c**: Pulse-Width Modulation (PWM) Interface for driving air-circulating fans.

**FS_math.c**: Implementations of non-standard math functions used in the project.

**gpio_switching_intf.c**: Interface to control the MOSFET and Solid State Relay switching of the system's pumps and valves.

**main.c**: Program entry point, setup, and superloop.

**mixing_motor.c**: GPIO interface to control a DROK L298 Motor Driver.

**SEN0169.c**: Interface to SEN0169 pH meter.

**SEN0244.c**: Interface to SEN0244 electrical conductivity meter.

**stm32h7xx_hal_msp.c**: Autogenerated file. Low-level initialization.

**stm32h7xx_it.c**: Autogenerated file. Interrupt service routines.

**syscalls.c**: Autogenerated file. Minimal syscalls file.

**timer.c**: Implementation of a 64-bit timer, to gracefully circumvent 32-bit timer overflow.

